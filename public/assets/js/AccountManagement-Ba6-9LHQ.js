import{E as v,g as ce,c as pe,i as W,j as X,b as Y,e as re,d as Z,k as _e,v as ee,m as me,q as fe,r as ye,o as ve,u as ke}from"./element-plus@2.7.7_vue@3.4.32_typescript@5.5.3_-BPm-_N_9.js";import{i as h}from"./index-B0cHC-7S.js";import{g as te}from"./enterprise-C4CPUMXu.js";import{d as ae,_ as be,$ as ge,m as le,o,G as m,H as t,i as a,L as c,I as ne,c as k,F as z,R as w,K as d,a as K}from"./@vue_runtime-core@3.4.32-BofAHbgu.js";import{r as V,u as O}from"./@vue_reactivity@3.4.32-DksAu7zd.js";import{f as J}from"./format-CyW-QbYa.js";import{L as _}from"./@vue_shared@3.4.32-CaCWPAm8.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.4.32-DNdjNMzo.js";import"./lodash-es@4.17.21-BB-zMWwC.js";import"./async-validator@4.2.5-DKvM95Vc.js";import"./@vueuse_core@9.13.0_vue@3.4.32_typescript@5.5.3_-DkVRVfGD.js";import"./@vueuse_shared@9.13.0_vue@3.4.32_typescript@5.5.3_-BbpdFR9m.js";import"./dayjs@1.11.11-Ct2Knyoi.js";import"./@element-plus_icons-vue@2.3.1_vue@3.4.32_typescript@5.5.3_-x2o2c_8n.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./pinia@2.1.7_typescript@5.5.3_vue@3.4.32_typescript@5.5.3_-BSzeUtha.js";import"./vue-demi@0.14.8_vue@3.4.32_typescript@5.5.3_-Dq6ymT-8.js";import"./axios@1.7.2-B4uVmeYG.js";import"./@fingerprintjs_fingerprintjs@4.5.1-5RNCfJbQ.js";import"./tslib@2.6.3-CPxunF3b.js";import"./vue-router@4.4.0_vue@3.4.32_typescript@5.5.3_-ByijA4Eg.js";const he=p=>h.post("/admin/account",p),Ae=p=>h.get(`/admin/account?page=${p.page}&size=${p.size}`),xe=p=>h.patch(`/admin/account/${p.id}`,p),$e=p=>h.patch("/admin/account/info",{account_ids:[p.id]}),Ce=p=>h.patch("/admin/account/info",{account_ids:p}),Ue=p=>h.delete("/admin/account",{data:{account_ids:[p.id]}}),ze=p=>h.delete("/admin/account",{data:{account_ids:p}}),Q=p=>h.patch("/admin/account/switch",p),Ee=p=>h.get(`/admin/account/ban?account_id=${p.id}`),Se=()=>h.patch("/admin/account/ban"),Le=ae({__name:"AddAccount",props:{modelValue:{},modelModifiers:{}},emits:be(["getAccounts"],["update:modelValue"]),setup(p,{emit:i}){const C=i,$=ge(p,"modelValue"),A=V(!1),r=V({type:1,cookie:"",enterprise_account_id:null}),b=V(null),F={cookie:[{required:!0,message:"请输入账户信息",trigger:"blur"}],enterprise_account_id:[{required:!1,message:"请选择关联的企业账号",trigger:"change"}]},I=V([]),M=async()=>{try{const g=await te({page:1,size:100,is_active:!0});I.value=g.data.list}catch(g){console.error("获取企业账号列表失败:",g)}};le(()=>{M()});const N=async g=>{if(!(!g||!await g.validate()))try{A.value=!0,(await he(r.value)).data.have_repeat&&v.info("存在重复的账号,已自动过滤"),v.success("添加成功")}finally{A.value=!1}},T=g=>{C("getAccounts"),g()},R=()=>{$.value=!1,C("getAccounts")};return(g,f)=>{const q=ce,x=pe,U=W,D=X,E=Y,P=re,u=Z,n=_e,y=ee;return o(),m(n,{title:"添加账号",width:"60%",modelValue:$.value,"onUpdate:modelValue":f[6]||(f[6]=s=>$.value=s),"before-close":T},{footer:t(()=>[a(u,{type:"info",onClick:f[4]||(f[4]=s=>R())},{default:t(()=>[c("取消")]),_:1}),a(u,{type:"primary",onClick:f[5]||(f[5]=s=>N(b.value))},{default:t(()=>[c("添加")]),_:1})]),default:t(()=>[ne((o(),m(P,{ref_key:"addAccountFormRef",ref:b,model:r.value,rules:F,"label-width":"auto"},{default:t(()=>[a(x,{label:"提示"},{default:t(()=>[a(q,null,{default:t(()=>[c("可以使用换行来分割多个账号")]),_:1})]),_:1}),a(x,{label:"账号类型"},{default:t(()=>[a(D,{modelValue:r.value.type,"onUpdate:modelValue":f[0]||(f[0]=s=>r.value.type=s)},{default:t(()=>[a(U,{label:"cookie",value:1}),a(U,{label:"token",value:2}),a(U,{label:"enterprise",value:3})]),_:1},8,["modelValue"])]),_:1}),r.value.type===1||r.value.type===3?(o(),m(x,{key:0,label:"Cookie",prop:"cookie"},{default:t(()=>[a(E,{type:"textarea",modelValue:r.value.cookie,"onUpdate:modelValue":f[1]||(f[1]=s=>r.value.cookie=s)},null,8,["modelValue"])]),_:1})):(o(),m(x,{key:1,label:"refresh_token",prop:"cookie"},{default:t(()=>[a(E,{type:"textarea",modelValue:r.value.cookie,"onUpdate:modelValue":f[2]||(f[2]=s=>r.value.cookie=s)},null,8,["modelValue"])]),_:1})),a(x,{label:"关联企业账号",prop:"enterprise_account_id"},{default:t(()=>[a(D,{modelValue:r.value.enterprise_account_id,"onUpdate:modelValue":f[3]||(f[3]=s=>r.value.enterprise_account_id=s),clearable:"",placeholder:"选择企业账号"},{default:t(()=>[(o(!0),k(z,null,w(I.value,s=>(o(),m(U,{key:s.id,label:s.cid,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[y,A.value]])]),_:1},8,["modelValue"])}}}),we={key:0},Ie={key:0},De={key:0},Be={key:0},Fe={key:0},Me={key:0},Ne={key:0},Te={key:0},Re={key:0},qe={key:0},Pe={key:0},je=ae({__name:"AccountManagement",setup(p){const i=V(!1),C=V(15),$=V(1),A=V(),r=V([]),b=async()=>{try{i.value=!0;const u=await Ae({page:$.value,size:C.value});u.data.data=u.data.data.map(n=>(n.switch=!!n.switch,n)),A.value=u.data}finally{i.value=!1}},F=async u=>{try{i.value=!0,await $e(u),v.success("更新账户信息成功")}finally{i.value=!1,await b()}},I=async()=>{try{i.value=!0;const u=r.value.map(n=>n.id);await Ce(u),v.success("批量更新账户成功")}finally{i.value=!1,await b()}},M=async u=>{try{i.value=!0,await Ue(u),v.success("删除账户成功")}finally{i.value=!1,await b()}},N=async()=>{try{i.value=!0;const u=r.value.map(n=>n.id);await ze(u),v.success("批量删除账户成功")}finally{i.value=!1,await b()}},T=async()=>{try{i.value=!0;const u=r.value.map(n=>n.id);await Q({account_ids:u,switch:1}),v.success("批量启用账户成功")}finally{i.value=!1,await b()}},R=async()=>{try{i.value=!0;const u=r.value.map(n=>n.id);await Q({account_ids:u,switch:0}),v.success("批量禁用账户成功")}finally{i.value=!1,await b()}},g=u=>r.value=u;le(async()=>{await b(),await P()});const f=V(!1),q=()=>f.value=!f.value,x=async u=>{if(u.edit=!u.edit,u.edit===!1)try{i.value=!0,await xe(u),v.success("修改賬號成功")}finally{i.value=!1,await b()}},U=async()=>{try{i.value=!0,await Se(),v.success("启用被限速账号成功")}finally{i.value=!1,await b()}},D=async u=>{try{i.value=!0;const n=await Ee(u);if(n.data.errno===0){const y=n.data.anti;v.success("获取封禁信息成功"),y.ban_status?(v.success("封禁状态：已封禁"),v.success(`封禁开始时间: ${new Date(parseInt(`${y.start_time}000`)).toLocaleString()}`),v.success(`封禁结束时间: ${new Date(parseInt(`${y.end_time}000`)).toLocaleString()}`),v.success(`已被封禁${y.ban_times}次`),v.success(`封禁原因: ${y.ban_reason}`)):v.success("封禁状态：未封禁")}else n.data.errno===-6?v.warning("获取封禁信息失败,Cookie或AccessToken已过期"):v.warning(`获取封禁信息失败,code:${n.data.errno},msg:${n.data.errmsg}`)}finally{i.value=!1}},E=V([]),P=async()=>{try{const u=await te({page:1,size:100,is_active:!0});E.value=u.data.list}catch(u){console.error("获取企业账号列表失败:",u)}};return(u,n)=>{var j,G,H;const y=Z,s=me,S=Y,L=W,B=X,oe=fe,se=ye,ue=ve,de=ke,ie=ee;return o(),k(z,null,[a(Le,{onGetAccounts:b,modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=e=>f.value=e)},null,8,["modelValue"]),a(y,{type:"primary",onClick:n[1]||(n[1]=e=>b())},{default:t(()=>[c("刷新列表")]),_:1}),a(y,{type:"primary",onClick:n[2]||(n[2]=e=>q())},{default:t(()=>[c("添加账号")]),_:1}),a(y,{type:"primary",disabled:r.value.length<=0,onClick:n[3]||(n[3]=e=>I())},{default:t(()=>[c(" 批量更新信息 ")]),_:1},8,["disabled"]),a(y,{type:"primary",disabled:r.value.length<=0,onClick:n[4]||(n[4]=e=>T())},{default:t(()=>[c(" 批量启用 ")]),_:1},8,["disabled"]),a(y,{type:"primary",disabled:r.value.length<=0,onClick:n[5]||(n[5]=e=>R())},{default:t(()=>[c(" 批量禁用 ")]),_:1},8,["disabled"]),a(y,{type:"danger",disabled:r.value.length<=0,onClick:n[6]||(n[6]=e=>N())},{default:t(()=>[c(" 批量删除 ")]),_:1},8,["disabled"]),a(y,{type:"primary",onClick:n[7]||(n[7]=e=>U())},{default:t(()=>[c(" 启用被限速的账号 ")]),_:1}),ne((o(),m(ue,{data:((j=A.value)==null?void 0:j.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:g},{default:t(()=>[a(s,{type:"selection",fixed:"",width:"40"}),a(s,{prop:"id",label:"ID",fixed:""}),a(s,{prop:"baidu_name",label:"百度用户名",width:"150px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",we,_(e.baidu_name),1)),e.edit?(o(),m(S,{key:1,modelValue:e.baidu_name,"onUpdate:modelValue":l=>e.baidu_name=l},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"today_size",label:"今日解析",width:"150px"},{default:t(({row:e})=>[K("span",null,_(e.today_count)+" ("+_(O(J)(e.today_size??0))+")",1)]),_:1}),a(s,{prop:"today_size",label:"总共解析",width:"150px"},{default:t(({row:e})=>[K("span",null,_(e.total_count)+" ("+_(O(J)(e.total_size??0))+")",1)]),_:1}),a(s,{prop:"account_type",label:"账号类型",width:"160px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Ie,_(e.account_type),1)),e.edit?(o(),m(B,{key:1,modelValue:e.account_type,"onUpdate:modelValue":l=>e.account_type=l},{default:t(()=>[(o(),k(z,null,w(["cookie","access_token"],l=>a(L,{key:l,value:l},{default:t(()=>[c(_(l),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"cookie",label:"Cookie",width:"150px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",De,_(e.cookie),1)),e.edit?(o(),m(S,{key:1,modelValue:e.cookie,"onUpdate:modelValue":l=>e.cookie=l},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"enterprise_account",label:"关联企业账号",width:"200px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Be,_(e.enterprise_account?`${e.enterprise_account.cid}`:"未关联"),1)),e.edit?(o(),m(B,{key:1,modelValue:e.enterprise_account_id,"onUpdate:modelValue":l=>e.enterprise_account_id=l,clearable:"",placeholder:"选择企业账号"},{default:t(()=>[(o(!0),k(z,null,w(E.value,l=>(o(),m(L,{key:l.id,label:l.cid,value:l.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"expired_at",label:"token过期时间",width:"160px"},{default:t(({row:e})=>[c(_(e.expired_at?new Date(e.expired_at).toLocaleString():"非token模式"),1)]),_:1}),a(s,{prop:"vip_type",label:"会员类型",width:"130px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Fe,_(e.vip_type),1)),e.edit?(o(),m(B,{key:1,modelValue:e.vip_type,"onUpdate:modelValue":l=>e.vip_type=l},{default:t(()=>[(o(),k(z,null,w(["超级会员","假超级会员","普通会员","普通用户"],l=>a(L,{key:l,value:l},{default:t(()=>[c(_(l),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"switch",label:"状态",width:"70px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Me,_(e.switch?"启用":"禁用"),1)),e.edit?(o(),m(oe,{key:1,modelValue:e.switch,"onUpdate:modelValue":l=>e.switch=l},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"prov",label:"省份",width:"120px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Ne,_(e.prov??"未使用"),1)),e.edit?(o(),m(B,{key:1,modelValue:e.prov,"onUpdate:modelValue":l=>e.prov=l},{default:t(()=>[(o(),m(L,{key:null,value:null},{default:t(()=>[c("未使用")]),_:1})),(o(),k(z,null,w(["北京市","天津市","上海市","重庆市","河北省","山西省","内蒙古自治区","辽宁省","吉林省","黑龙江省","江苏省","浙江省","安徽省","福建省","江西省","山东省","河南省","湖北省","湖南省","广东省","广西壮族自治区","海南省","四川省","贵州省","云南省","西藏自治区","陕西省","甘肃省","青海省","宁夏回族自治区","新疆维吾尔自治区","香港特别行政区","澳门特别行政区","台湾省"],l=>a(L,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"reason",label:"禁用原因",width:"150px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Te,_(e.reason??"未禁用"),1)),e.edit?(o(),m(S,{key:1,modelValue:e.reason,"onUpdate:modelValue":l=>e.reason=l},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"access_token",label:"access_token",width:"150px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Re,_(e.access_token),1)),e.edit?(o(),m(S,{key:1,modelValue:e.access_token,"onUpdate:modelValue":l=>e.access_token=l},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"refresh_token",label:"refresh_token",width:"150px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",qe,_(e.refresh_token),1)),e.edit?(o(),m(S,{key:1,modelValue:e.refresh_token,"onUpdate:modelValue":l=>e.refresh_token=l},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"cid",label:"cid",width:"200px"},{default:t(({row:e})=>[e.edit?d("",!0):(o(),k("span",Pe,_(e.cid),1)),e.edit?(o(),m(se,{key:1,modelValue:e.cid,"onUpdate:modelValue":l=>e.cid=l,style:{width:"170px"}},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)]),_:1}),a(s,{prop:"svip_end_at",label:"超级会员结束时间",width:"160px"},{default:t(({row:e})=>[c(_(new Date(e.svip_end_at).toLocaleString()),1)]),_:1}),a(s,{prop:"last_use_at",label:"上次使用时间",width:"160px"},{default:t(({row:e})=>[c(_(new Date(e.last_use_at).toLocaleString()),1)]),_:1}),a(s,{prop:"created_at",label:"创建时间",width:"160px"},{default:t(({row:e})=>[c(_(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(s,{prop:"updated_at",label:"更新时间",width:"160px"},{default:t(({row:e})=>[c(_(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(s,{width:"350",label:"操作",fixed:"right"},{default:t(({row:e})=>[a(y,{size:"small",type:"primary",disabled:e.id===0,onClick:l=>F(e)},{default:t(()=>[c("更新信息")]),_:2},1032,["disabled","onClick"]),a(y,{size:"small",type:"primary",disabled:e.id===0,onClick:l=>D(e)},{default:t(()=>[c(" 检查封禁状态 ")]),_:2},1032,["disabled","onClick"]),e.edit?d("",!0):(o(),m(y,{key:0,size:"small",type:"primary",disabled:e.id===0,onClick:l=>x(e)},{default:t(()=>[c(" 編輯 ")]),_:2},1032,["disabled","onClick"])),e.edit?(o(),m(y,{key:1,size:"small",type:"primary",disabled:e.id===0,onClick:l=>x(e)},{default:t(()=>[c(" 完成 ")]),_:2},1032,["disabled","onClick"])):d("",!0),a(y,{size:"small",type:"danger",disabled:e.id===0,onClick:l=>M(e)},{default:t(()=>[c("删除")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[ie,i.value]]),a(de,{"current-page":$.value,"onUpdate:currentPage":n[8]||(n[8]=e=>$.value=e),"page-size":C.value,"onUpdate:pageSize":n[9]||(n[9]=e=>C.value=e),"page-sizes":[15,50,100,500,((G=A.value)==null?void 0:G.total)??100],total:((H=A.value)==null?void 0:H.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),mt=Ve(je,[["__scopeId","data-v-ca3ebfb6"]]);export{mt as default};
