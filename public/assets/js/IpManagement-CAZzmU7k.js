/* empty css             *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                  */import{k as K,av as ee,aw as te,a as m,l as g,J as C,K as n,S as a,Q as u,L as b,m as R,F as B,a7 as Q,d as ae,p as G,R as z,T as S,P as J}from"./vue-vendor-BPxk_gY3.js";import{i as k}from"./index-PNpWQo2V.js";/* empty css                   *//* empty css                     */import{E as A,b as q,c as le,i as H,j as W,e as oe,d as X,k as ne,v as Y,m as se,o as de,u as ie}from"./element-plus-vendor-C_pH9kLN.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./other-vendor-DRuaNSIU.js";const ue=s=>k.post("/admin/ip",s),re=s=>k.get(`/admin/ip?page=${s.page}&size=${s.size}`),me=s=>k.patch(`/admin/ip/${s.id}`,s),fe=s=>k.delete("/admin/ip",{data:{ip_ids:[s.id]}}),ve=s=>k.delete("/admin/ip",{data:{ip_ids:s}}),ce=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,_e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))/,Z=s=>ce.test(s)||_e.test(s),ge=K({__name:"AddIp",props:{modelValue:{},modelModifiers:{}},emits:ee(["getIps"],["update:modelValue"]),setup(s,{emit:i}){const V=i,I=te(s,"modelValue"),f=m(!1),F=(v,l,y)=>{if(!l)return y(new Error("请输入IP地址"));Z(l)?y():y(new Error("请输入有效的IP地址"))},d=m({ip:"",mode:0}),E=m(null),U={ip:[{validator:F,message:"请输入IP",trigger:"blur"}]},w=async v=>{if(!(!v||!await v.validate()))try{f.value=!0,await ue(d.value),A.success("添加成功")}finally{f.value=!1}},M=v=>{V("getIps"),v()},x=()=>{I.value=!1,V("getIps")};return(v,l)=>{const y=q,o=le,t=H,c=W,r=oe,P=X,D=ne,L=Y;return g(),C(D,{title:"添加IP",width:"60%",modelValue:I.value,"onUpdate:modelValue":l[4]||(l[4]=p=>I.value=p),"before-close":M},{footer:n(()=>[a(P,{type:"info",onClick:l[2]||(l[2]=p=>x())},{default:n(()=>l[5]||(l[5]=[u("取消")])),_:1}),a(P,{type:"primary",onClick:l[3]||(l[3]=p=>w(E.value))},{default:n(()=>l[6]||(l[6]=[u("添加")])),_:1})]),default:n(()=>[b((g(),C(r,{ref_key:"addIpFormRef",ref:E,model:d.value,rules:U,"label-width":"auto"},{default:n(()=>[a(o,{label:"IP",prop:"ip"},{default:n(()=>[a(y,{modelValue:d.value.ip,"onUpdate:modelValue":l[0]||(l[0]=p=>d.value.ip=p)},null,8,["modelValue"])]),_:1}),a(o,{label:"模式",prop:"mode"},{default:n(()=>[a(c,{modelValue:d.value.mode,"onUpdate:modelValue":l[1]||(l[1]=p=>d.value.mode=p)},{default:n(()=>[(g(),R(B,null,Q(["黑名单","白名单"],(p,$)=>a(t,{key:$,label:p,value:$},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[L,f.value]])]),_:1},8,["modelValue"])}}}),Ie=K({__name:"IpManagement",setup(s){const i=m(!1),V=m(15),I=m(1),f=m(),F=m([]),d=async()=>{try{i.value=!0;const o=await re({page:I.value,size:V.value});f.value=o.data}finally{i.value=!1}},E=async o=>{o.edit=!(o.edit??!1)},U=async o=>{if(!Z(o.ip))return A.error("请输入正确的IP");o.edit=!(o.edit??!0),await w(o)},w=async o=>{try{i.value=!0,await me(o),A.success("修改IP成功")}finally{i.value=!1,await d()}},M=async o=>{try{i.value=!0,await fe(o),A.success("删除IP成功")}finally{i.value=!1,await d()}},x=async()=>{try{i.value=!0;const o=F.value.map(t=>t.id);await ve(o),A.success("批量删除IP成功")}finally{i.value=!1,await d()}},v=o=>F.value=o;ae(d);const l=m(!1),y=()=>l.value=!l.value;return(o,t)=>{var N,T,O;const c=X,r=se,P=q,D=H,L=W,p=de,$=ie,h=Y;return g(),R(B,null,[a(ge,{onGetIps:d,modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e)},null,8,["modelValue"]),a(c,{type:"primary",onClick:t[1]||(t[1]=e=>d())},{default:n(()=>t[6]||(t[6]=[u("刷新列表")])),_:1}),a(c,{type:"primary",onClick:t[2]||(t[2]=e=>y())},{default:n(()=>t[7]||(t[7]=[u("添加IP")])),_:1}),a(c,{type:"danger",disabled:F.value.length<=0,onClick:t[3]||(t[3]=e=>x())},{default:n(()=>t[8]||(t[8]=[u(" 批量删除 ")])),_:1},8,["disabled"]),b((g(),C(p,{data:((N=f.value)==null?void 0:N.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:v},{default:n(()=>[a(r,{type:"selection",width:"40"}),a(r,{prop:"id",label:"ID"}),a(r,{prop:"ip",label:"IP"},{default:n(({row:e})=>[b(G("span",null,z(e.ip),513),[[S,!e.edit]]),b(a(P,{modelValue:e.ip,"onUpdate:modelValue":_=>e.ip=_},null,8,["modelValue","onUpdate:modelValue"]),[[S,e.edit]])]),_:1}),a(r,{prop:"mode",label:"模式"},{default:n(({row:e})=>[b(G("span",null,z(e.mode?"白名单":"黑名单"),513),[[S,!e.edit]]),b(a(L,{modelValue:e.mode,"onUpdate:modelValue":_=>e.mode=_},{default:n(()=>[(g(),R(B,null,Q(["黑名单","白名单"],(_,j)=>a(D,{key:j,label:_,value:j},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[S,e.edit]])]),_:1}),a(r,{prop:"created_at",label:"创建时间"},{default:n(({row:e})=>[u(z(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(r,{prop:"updated_at",label:"更新时间"},{default:n(({row:e})=>[u(z(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(r,{width:"150",label:"操作",fixed:"right"},{default:n(({row:e})=>[e.edit?J("",!0):(g(),C(c,{key:0,size:"small",type:"primary",onClick:_=>E(e)},{default:n(()=>t[9]||(t[9]=[u(" 编辑 ")])),_:2},1032,["onClick"])),e.edit?(g(),C(c,{key:1,size:"small",type:"primary",onClick:_=>U(e)},{default:n(()=>t[10]||(t[10]=[u(" 保存 ")])),_:2},1032,["onClick"])):J("",!0),a(c,{size:"small",type:"danger",onClick:_=>M(e)},{default:n(()=>t[11]||(t[11]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[h,i.value]]),a($,{"current-page":I.value,"onUpdate:currentPage":t[4]||(t[4]=e=>I.value=e),"page-size":V.value,"onUpdate:pageSize":t[5]||(t[5]=e=>V.value=e),"page-sizes":[15,50,100,500,((T=f.value)==null?void 0:T.total)??100],total:((O=f.value)==null?void 0:O.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),xe=pe(Ie,[["__scopeId","data-v-bfd061e8"]]);export{xe as default};
