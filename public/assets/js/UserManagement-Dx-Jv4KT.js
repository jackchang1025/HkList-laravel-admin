/* empty css             *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                  */import{k as G,av as ee,aw as le,a as f,l as V,J as S,K as t,S as l,Q as v,L as U,m as A,F as N,a7 as J,d as ae,p as C,R as i,u as O,T as E,P as q}from"./vue-vendor-BPxk_gY3.js";import{i as w}from"./index-PNpWQo2V.js";/* empty css                   *//* empty css                     */import{E as x,b as K,c as te,i as Q,j as H,e as oe,d as W,k as se,v as X,m as ne,o as de,u as ue}from"./element-plus-vendor-C_pH9kLN.js";import{f as j}from"./format-CyW-QbYa.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./other-vendor-DRuaNSIU.js";const ie=u=>w.post("/admin/user",u),pe=u=>w.get(`/admin/user?page=${u.page}&size=${u.size}`),me=u=>w.patch(`/admin/user/${u.id}`,u),_e=u=>w.delete("/admin/user",{data:{user_ids:[u.id]}}),ve=u=>w.delete("/admin/user",{data:{user_ids:u}}),fe=G({__name:"AddUser",props:{modelValue:{},modelModifiers:{}},emits:ee(["getUsers"],["update:modelValue"]),setup(u,{emit:m}){const z=m,b=le(u,"modelValue"),c=f(!1),r=f({username:"",password:"",role:"user",inv_code_id:1}),_=f(null),F={username:[{required:!0,message:"请输入账户用户名",trigger:"blur"}],password:[{required:!0,message:"请输入账户密码",trigger:"blur"}]},D=async k=>{if(!(!k||!await k.validate()))try{c.value=!0,await ie(r.value),x.success("添加成功")}finally{c.value=!1}},B=k=>{z("getUsers"),k()},L=()=>{b.value=!1,z("getUsers")};return(k,o)=>{const g=K,$=te,s=Q,a=H,y=oe,d=W,M=se,I=X;return V(),S(M,{title:"添加用户",width:"60%",modelValue:b.value,"onUpdate:modelValue":o[6]||(o[6]=n=>b.value=n),"before-close":B},{footer:t(()=>[l(d,{type:"info",onClick:o[4]||(o[4]=n=>L())},{default:t(()=>o[7]||(o[7]=[v("取消")])),_:1}),l(d,{type:"primary",onClick:o[5]||(o[5]=n=>D(_.value))},{default:t(()=>o[8]||(o[8]=[v("添加")])),_:1})]),default:t(()=>[U((V(),S(y,{ref_key:"addUserFormRef",ref:_,model:r.value,rules:F,"label-width":"auto"},{default:t(()=>[l($,{label:"用户名",prop:"username"},{default:t(()=>[l(g,{modelValue:r.value.username,"onUpdate:modelValue":o[0]||(o[0]=n=>r.value.username=n)},null,8,["modelValue"])]),_:1}),l($,{label:"密码",prop:"password"},{default:t(()=>[l(g,{modelValue:r.value.password,"onUpdate:modelValue":o[1]||(o[1]=n=>r.value.password=n)},null,8,["modelValue"])]),_:1}),l($,{label:"权限",prop:"role"},{default:t(()=>[l(a,{modelValue:r.value.role,"onUpdate:modelValue":o[2]||(o[2]=n=>r.value.role=n)},{default:t(()=>[(V(),A(N,null,J(["user","admin"],n=>l(s,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l($,{label:"邀请码ID",prop:"inv_code_id"},{default:t(()=>[l(g,{modelValue:r.value.inv_code_id,"onUpdate:modelValue":o[3]||(o[3]=n=>r.value.inv_code_id=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[I,c.value]])]),_:1},8,["modelValue"])}}}),ce=G({__name:"UserManagement",setup(u){const m=f(!1),z=f(15),b=f(1),c=f(),r=f([]),_=async()=>{try{m.value=!0;const s=await pe({page:b.value,size:z.value});c.value=s.data}finally{m.value=!1}},F=async s=>{s.edit=!(s.edit??!1)},D=async s=>{s.edit=!(s.edit??!0),await B(s)},B=async s=>{try{m.value=!0,await me(s),x.success("修改用户成功")}finally{m.value=!1,await _()}},L=async s=>{try{m.value=!0,await _e(s),x.success("删除用户成功")}finally{m.value=!1,await _()}},k=async()=>{try{m.value=!0;const s=r.value.map(a=>a.id);await ve(s),x.success("批量删除用户成功")}finally{m.value=!1,await _()}},o=s=>r.value=s;ae(_);const g=f(!1),$=()=>g.value=!g.value;return(s,a)=>{var P,R,T;const y=W,d=ne,M=K,I=Q,n=H,Y=de,Z=ue,h=X;return V(),A(N,null,[l(fe,{onGetUsers:_,modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e)},null,8,["modelValue"]),l(y,{type:"primary",onClick:a[1]||(a[1]=e=>_())},{default:t(()=>a[6]||(a[6]=[v("刷新列表")])),_:1}),l(y,{type:"primary",onClick:a[2]||(a[2]=e=>$())},{default:t(()=>a[7]||(a[7]=[v("添加用户")])),_:1}),l(y,{type:"danger",disabled:r.value.length<=0,onClick:a[3]||(a[3]=e=>k())},{default:t(()=>a[8]||(a[8]=[v(" 批量删除 ")])),_:1},8,["disabled"]),U((V(),S(Y,{data:((P=c.value)==null?void 0:P.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:o},{default:t(()=>[l(d,{type:"selection",width:"40"}),l(d,{prop:"id",label:"ID"}),l(d,{prop:"",label:"用户组"},{default:t(({row:e})=>[C("span",null,i(e.group.id)+" ("+i(e.group.name)+")",1)]),_:1}),l(d,{prop:"inv_code.name",label:"邀请码"},{default:t(({row:e})=>[C("span",null,i(e.inv_code.id)+" ("+i(e.inv_code.name)+")",1)]),_:1}),l(d,{prop:"today_size",label:"今日解析"},{default:t(({row:e})=>[C("span",null,i(e.today_count)+" ("+i(O(j)(e.today_size??0))+")",1)]),_:1}),l(d,{prop:"today_size",label:"縂共解析"},{default:t(({row:e})=>[C("span",null,i(e.total_count)+" ("+i(O(j)(e.total_size??0))+")",1)]),_:1}),l(d,{prop:"username",label:"用户名"},{default:t(({row:e})=>[U(C("span",null,i(e.username),513),[[E,!e.edit]]),U(l(M,{modelValue:e.username,"onUpdate:modelValue":p=>e.username=p},null,8,["modelValue","onUpdate:modelValue"]),[[E,e.edit]])]),_:1}),l(d,{prop:"password",label:"密码"},{default:t(({row:e})=>[U(C("span",null,i(e.password),513),[[E,!e.edit]]),U(l(M,{modelValue:e.password,"onUpdate:modelValue":p=>e.password=p},null,8,["modelValue","onUpdate:modelValue"]),[[E,e.edit]])]),_:1}),l(d,{prop:"role",label:"权限"},{default:t(({row:e})=>[U(C("span",null,i(e.role),513),[[E,!e.edit]]),U(l(n,{modelValue:e.role,"onUpdate:modelValue":p=>e.role=p},{default:t(()=>[(V(),A(N,null,J(["user","admin"],p=>l(I,{key:p,label:p,value:p},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[E,e.edit]])]),_:1}),l(d,{prop:"created_at",label:"创建时间"},{default:t(({row:e})=>[v(i(new Date(e.created_at).toLocaleString()),1)]),_:1}),l(d,{prop:"updated_at",label:"更新时间"},{default:t(({row:e})=>[v(i(new Date(e.updated_at).toLocaleString()),1)]),_:1}),l(d,{width:"150",label:"操作",fixed:"right"},{default:t(({row:e})=>[e.edit?q("",!0):(V(),S(y,{key:0,size:"small",type:"primary",onClick:p=>F(e)},{default:t(()=>a[9]||(a[9]=[v(" 编辑 ")])),_:2},1032,["onClick"])),e.edit?(V(),S(y,{key:1,size:"small",type:"primary",onClick:p=>D(e)},{default:t(()=>a[10]||(a[10]=[v(" 保存 ")])),_:2},1032,["onClick"])):q("",!0),l(y,{size:"small",type:"danger",onClick:p=>L(e)},{default:t(()=>a[11]||(a[11]=[v("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[h,m.value]]),l(Z,{"current-page":b.value,"onUpdate:currentPage":a[4]||(a[4]=e=>b.value=e),"page-size":z.value,"onUpdate:pageSize":a[5]||(a[5]=e=>z.value=e),"page-sizes":[15,50,100,500,((R=c.value)==null?void 0:R.total)??100],total:((T=c.value)==null?void 0:T.total)??100,layout:"sizes, prev, pager, next",onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Be=re(ce,[["__scopeId","data-v-39a05d3b"]]);export{Be as default};
