import{E as f,g as se,c as de,i as J,j as Q,b as W,e as ue,d as X,k as ie,v as Y,m as ce,r as pe,q as re,o as me,s as _e}from"./element-plus@2.7.7_vue@3.4.32_typescript@5.5.3_-4orX1JGZ.js";import{i as g}from"./index-DYV93AZk.js";import{d as Z,_ as fe,$ as ye,o,G as y,H as t,i as a,L as i,I as ee,m as ve,c as b,K as p,a as G,F as I,R}from"./@vue_runtime-core@3.4.32-BofAHbgu.js";import{r as A,u as H}from"./@vue_reactivity@3.4.32-DksAu7zd.js";import{f as K}from"./format-CyW-QbYa.js";import{L as r}from"./@vue_shared@3.4.32-CaCWPAm8.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.4.32-DNdjNMzo.js";import"./lodash-es@4.17.21-BB-zMWwC.js";import"./async-validator@4.2.5-DKvM95Vc.js";import"./@vueuse_core@9.13.0_vue@3.4.32_typescript@5.5.3_-DkVRVfGD.js";import"./@vueuse_shared@9.13.0_vue@3.4.32_typescript@5.5.3_-BbpdFR9m.js";import"./dayjs@1.11.11-Ct2Knyoi.js";import"./@element-plus_icons-vue@2.3.1_vue@3.4.32_typescript@5.5.3_-x2o2c_8n.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./pinia@2.1.7_typescript@5.5.3_vue@3.4.32_typescript@5.5.3_-BSzeUtha.js";import"./vue-demi@0.14.8_vue@3.4.32_typescript@5.5.3_-Dq6ymT-8.js";import"./axios@1.7.2-B4uVmeYG.js";import"./@fingerprintjs_fingerprintjs@4.5.1-5RNCfJbQ.js";import"./tslib@2.6.3-CPxunF3b.js";import"./vue-router@4.4.0_vue@3.4.32_typescript@5.5.3_-ByijA4Eg.js";const be=c=>g.post("/admin/account",c),ge=c=>g.get(`/admin/account?page=${c.page}&size=${c.size}`),Ve=c=>g.patch(`/admin/account/${c.id}`,c),Ae=c=>g.patch("/admin/account/info",{account_ids:[c.id]}),he=c=>g.patch("/admin/account/info",{account_ids:c}),xe=c=>g.delete("/admin/account",{data:{account_ids:[c.id]}}),$e=c=>g.delete("/admin/account",{data:{account_ids:c}}),O=c=>g.patch("/admin/account/switch",c),Ce=c=>g.get(`/admin/account/ban?account_id=${c.id}`),Ue=()=>g.patch("/admin/account/ban"),ze=Z({__name:"AddAccount",props:{modelValue:{},modelModifiers:{}},emits:fe(["getAccounts"],["update:modelValue"]),setup(c,{emit:u}){const C=u,x=ye(c,"modelValue"),h=A(!1),m=A({type:1,cookie:""}),v=A(null),L={cookie:[{required:!0,message:"请输入账户信息",trigger:"blur"}]},D=async $=>{if(!(!$||!await $.validate()))try{h.value=!0,(await be(m.value)).data.have_repeat&&f.info("存在重复的账号,已自动过滤"),f.success("添加成功")}finally{h.value=!1}},B=$=>{C("getAccounts"),$()},F=()=>{x.value=!1,C("getAccounts")};return($,k)=>{const M=se,V=de,U=J,S=Q,E=W,N=ue,d=X,l=ie,_=Y;return o(),y(l,{title:"添加账号",width:"60%",modelValue:x.value,"onUpdate:modelValue":k[5]||(k[5]=s=>x.value=s),"before-close":B},{footer:t(()=>[a(d,{type:"info",onClick:k[3]||(k[3]=s=>F())},{default:t(()=>[i("取消")]),_:1}),a(d,{type:"primary",onClick:k[4]||(k[4]=s=>D(v.value))},{default:t(()=>[i("添加")]),_:1})]),default:t(()=>[ee((o(),y(N,{ref_key:"addAccountFormRef",ref:v,model:m.value,rules:L,"label-width":"auto"},{default:t(()=>[a(V,{label:"提示"},{default:t(()=>[a(M,null,{default:t(()=>[i("可以使用换行来分割多个账号")]),_:1})]),_:1}),a(V,{label:"账号类型"},{default:t(()=>[a(S,{modelValue:m.value.type,"onUpdate:modelValue":k[0]||(k[0]=s=>m.value.type=s)},{default:t(()=>[a(U,{label:"cookie",value:1}),a(U,{label:"token",value:2}),a(U,{label:"enterprise",value:3})]),_:1},8,["modelValue"])]),_:1}),m.value.type===1||m.value.type===3?(o(),y(V,{key:0,label:"Cookie",prop:"cookie"},{default:t(()=>[a(E,{type:"textarea",modelValue:m.value.cookie,"onUpdate:modelValue":k[1]||(k[1]=s=>m.value.cookie=s)},null,8,["modelValue"])]),_:1})):(o(),y(V,{key:1,label:"refresh_token",prop:"cookie"},{default:t(()=>[a(E,{type:"textarea",modelValue:m.value.cookie,"onUpdate:modelValue":k[2]||(k[2]=s=>m.value.cookie=s)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[_,h.value]])]),_:1},8,["modelValue"])}}}),Se={key:0},Ee={key:0},we={key:0},Ie={key:0},Le={key:0},De={key:0},Be={key:0},Fe={key:0},Me={key:0},Ne={key:0},Te=Z({__name:"AccountManagement",setup(c){const u=A(!1),C=A(15),x=A(1),h=A(),m=A([]),v=async()=>{try{u.value=!0;const d=await ge({page:x.value,size:C.value});d.data.data=d.data.data.map(l=>(l.switch=!!l.switch,l)),h.value=d.data}finally{u.value=!1}},L=async d=>{try{u.value=!0,await Ae(d),f.success("更新账户信息成功")}finally{u.value=!1,await v()}},D=async()=>{try{u.value=!0;const d=m.value.map(l=>l.id);await he(d),f.success("批量更新账户成功")}finally{u.value=!1,await v()}},B=async d=>{try{u.value=!0,await xe(d),f.success("删除账户成功")}finally{u.value=!1,await v()}},F=async()=>{try{u.value=!0;const d=m.value.map(l=>l.id);await $e(d),f.success("批量删除账户成功")}finally{u.value=!1,await v()}},$=async()=>{try{u.value=!0;const d=m.value.map(l=>l.id);await O({account_ids:d,switch:1}),f.success("批量启用账户成功")}finally{u.value=!1,await v()}},k=async()=>{try{u.value=!0;const d=m.value.map(l=>l.id);await O({account_ids:d,switch:0}),f.success("批量禁用账户成功")}finally{u.value=!1,await v()}},M=d=>m.value=d;ve(v);const V=A(!1),U=()=>V.value=!V.value,S=async d=>{if(d.edit=!d.edit,d.edit===!1)try{u.value=!0,await Ve(d),f.success("修改賬號成功")}finally{u.value=!1,await v()}},E=async()=>{try{u.value=!0,await Ue(),f.success("启用被限速账号成功")}finally{u.value=!1,await v()}},N=async d=>{try{u.value=!0;const l=await Ce(d);if(l.data.errno===0){const _=l.data.anti;f.success("获取封禁信息成功"),_.ban_status?(f.success("封禁状态：已封禁"),f.success(`封禁开始时间: ${new Date(parseInt(`${_.start_time}000`)).toLocaleString()}`),f.success(`封禁结束时间: ${new Date(parseInt(`${_.end_time}000`)).toLocaleString()}`),f.success(`已被封禁${_.ban_times}次`),f.success(`封禁原因: ${_.ban_reason}`)):f.success("封禁状态：未封禁")}else l.data.errno===-6?f.warning("获取封禁信息失败,Cookie或AccessToken已过期"):f.warning(`获取封禁信息失败,code:${l.data.errno},msg:${l.data.errmsg}`)}finally{u.value=!1}};return(d,l)=>{var P,j,q;const _=X,s=ce,z=W,w=J,T=Q,te=pe,ae=re,le=me,ne=_e,oe=Y;return o(),b(I,null,[a(ze,{onGetAccounts:v,modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value=e)},null,8,["modelValue"]),a(_,{type:"primary",onClick:l[1]||(l[1]=e=>v())},{default:t(()=>[i("刷新列表")]),_:1}),a(_,{type:"primary",onClick:l[2]||(l[2]=e=>U())},{default:t(()=>[i("添加账号")]),_:1}),a(_,{type:"primary",disabled:m.value.length<=0,onClick:l[3]||(l[3]=e=>D())},{default:t(()=>[i(" 批量更新信息 ")]),_:1},8,["disabled"]),a(_,{type:"primary",disabled:m.value.length<=0,onClick:l[4]||(l[4]=e=>$())},{default:t(()=>[i(" 批量启用 ")]),_:1},8,["disabled"]),a(_,{type:"primary",disabled:m.value.length<=0,onClick:l[5]||(l[5]=e=>k())},{default:t(()=>[i(" 批量禁用 ")]),_:1},8,["disabled"]),a(_,{type:"danger",disabled:m.value.length<=0,onClick:l[6]||(l[6]=e=>F())},{default:t(()=>[i(" 批量删除 ")]),_:1},8,["disabled"]),a(_,{type:"primary",onClick:l[7]||(l[7]=e=>E())},{default:t(()=>[i(" 启用被限速的账号 ")]),_:1}),ee((o(),y(le,{data:((P=h.value)==null?void 0:P.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:M},{default:t(()=>[a(s,{type:"selection",fixed:"",width:"40"}),a(s,{prop:"id",label:"ID",fixed:""}),a(s,{prop:"baidu_name",label:"百度用户名",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Se,r(e.baidu_name),1)),e.edit?(o(),y(z,{key:1,modelValue:e.baidu_name,"onUpdate:modelValue":n=>e.baidu_name=n},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"today_size",label:"今日解析",width:"150px"},{default:t(({row:e})=>[G("span",null,r(e.today_count)+" ("+r(H(K)(e.today_size??0))+")",1)]),_:1}),a(s,{prop:"today_size",label:"总共解析",width:"150px"},{default:t(({row:e})=>[G("span",null,r(e.total_count)+" ("+r(H(K)(e.total_size??0))+")",1)]),_:1}),a(s,{prop:"account_type",label:"账号类型",width:"160px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Ee,r(e.account_type),1)),e.edit?(o(),y(T,{key:1,modelValue:e.account_type,"onUpdate:modelValue":n=>e.account_type=n},{default:t(()=>[(o(),b(I,null,R(["cookie","access_token"],n=>a(w,{key:n,value:n},{default:t(()=>[i(r(n),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"cookie",label:"Cookie",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",we,r(e.cookie),1)),e.edit?(o(),y(z,{key:1,modelValue:e.cookie,"onUpdate:modelValue":n=>e.cookie=n},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"access_token",label:"access_token",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Ie,r(e.access_token),1)),e.edit?(o(),y(z,{key:1,modelValue:e.access_token,"onUpdate:modelValue":n=>e.access_token=n},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"refresh_token",label:"refresh_token",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Le,r(e.refresh_token),1)),e.edit?(o(),y(z,{key:1,modelValue:e.refresh_token,"onUpdate:modelValue":n=>e.refresh_token=n},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"cid",label:"cid",width:"200px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",De,r(e.cid),1)),e.edit?(o(),y(te,{key:1,modelValue:e.cid,"onUpdate:modelValue":n=>e.cid=n,style:{width:"170px"}},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"expired_at",label:"token过期时间",width:"160px"},{default:t(({row:e})=>[i(r(e.expired_at?new Date(e.expired_at).toLocaleString():"非token模式"),1)]),_:1}),a(s,{prop:"vip_type",label:"会员类型",width:"130px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Be,r(e.vip_type),1)),e.edit?(o(),y(T,{key:1,modelValue:e.vip_type,"onUpdate:modelValue":n=>e.vip_type=n},{default:t(()=>[(o(),b(I,null,R(["超级会员","假超级会员","普通会员","普通用户"],n=>a(w,{key:n,value:n},{default:t(()=>[i(r(n),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"switch",label:"状态",width:"70px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Fe,r(e.switch?"启用":"禁用"),1)),e.edit?(o(),y(ae,{key:1,modelValue:e.switch,"onUpdate:modelValue":n=>e.switch=n},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"prov",label:"省份",width:"120px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Me,r(e.prov??"未使用"),1)),e.edit?(o(),y(T,{key:1,modelValue:e.prov,"onUpdate:modelValue":n=>e.prov=n},{default:t(()=>[(o(),y(w,{key:null,value:null},{default:t(()=>[i("未使用")]),_:1})),(o(),b(I,null,R(["北京市","天津市","上海市","重庆市","河北省","山西省","内蒙古自治区","辽宁省","吉林省","黑龙江省","江苏省","浙江省","安徽省","福建省","江西省","山东省","河南省","湖北省","湖南省","广东省","广西壮族自治区","海南省","四川省","贵州省","云南省","西藏自治区","陕西省","甘肃省","青海省","宁夏回族自治区","新疆维吾尔自治区","香港特别行政区","澳门特别行政区","台湾省"],n=>a(w,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"reason",label:"禁用原因",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(o(),b("span",Ne,r(e.reason??"未禁用"),1)),e.edit?(o(),y(z,{key:1,modelValue:e.reason,"onUpdate:modelValue":n=>e.reason=n},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(s,{prop:"svip_end_at",label:"超级会员结束时间",width:"160px"},{default:t(({row:e})=>[i(r(new Date(e.svip_end_at).toLocaleString()),1)]),_:1}),a(s,{prop:"last_use_at",label:"上次使用时间",width:"160px"},{default:t(({row:e})=>[i(r(new Date(e.last_use_at).toLocaleString()),1)]),_:1}),a(s,{prop:"created_at",label:"创建时间",width:"160px"},{default:t(({row:e})=>[i(r(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(s,{prop:"updated_at",label:"更新时间",width:"160px"},{default:t(({row:e})=>[i(r(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(s,{width:"350",label:"操作",fixed:"right"},{default:t(({row:e})=>[a(_,{size:"small",type:"primary",disabled:e.id===0,onClick:n=>L(e)},{default:t(()=>[i("更新信息")]),_:2},1032,["disabled","onClick"]),a(_,{size:"small",type:"primary",disabled:e.id===0,onClick:n=>N(e)},{default:t(()=>[i(" 检查封禁状态 ")]),_:2},1032,["disabled","onClick"]),e.edit?p("",!0):(o(),y(_,{key:0,size:"small",type:"primary",disabled:e.id===0,onClick:n=>S(e)},{default:t(()=>[i(" 編輯 ")]),_:2},1032,["disabled","onClick"])),e.edit?(o(),y(_,{key:1,size:"small",type:"primary",disabled:e.id===0,onClick:n=>S(e)},{default:t(()=>[i(" 完成 ")]),_:2},1032,["disabled","onClick"])):p("",!0),a(_,{size:"small",type:"danger",disabled:e.id===0,onClick:n=>B(e)},{default:t(()=>[i("删除")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[oe,u.value]]),a(ne,{"current-page":x.value,"onUpdate:currentPage":l[8]||(l[8]=e=>x.value=e),"page-size":C.value,"onUpdate:pageSize":l[9]||(l[9]=e=>C.value=e),"page-sizes":[15,50,100,500,((j=h.value)==null?void 0:j.total)??100],total:((q=h.value)==null?void 0:q.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),it=ke(Te,[["__scopeId","data-v-a8baa8b2"]]);export{it as default};
