/* empty css             *//* empty css                   *//* empty css                *//* empty css                     *//* empty css                  *//* empty css                 */import{u as ee}from"./fileListStore-CHH6_NpV.js";import{u as te,a as le,c as T,g as N}from"./index-PNpWQo2V.js";import{c as oe}from"./copy-DePUZc8M.js";import{f as Z}from"./format-CyW-QbYa.js";import{i as se}from"./isMobile-BD0f7XPI.js";import{k as ae,a as $,au as P,d as re,n as ne,at as ie,L as ue,u as t,l as r,J as d,K as a,p as k,R as v,P as f,m as V,Q as y,S as n,F as S}from"./vue-vendor-BPxk_gY3.js";import{E as C,l as de,b as pe,c as me,d as fe,e as ge,a as ce,v as ke}from"./element-plus-vendor-C_pH9kLN.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./other-vendor-DRuaNSIU.js";const ye={key:0},_e={key:1},we=["src"],be=ae({__name:"GetFileList",setup(Ve){const M=$("right");se()&&(M.value="top");const _=ee(),{pending:G,getFileListForm:l,getFileListFormRef:U,selectedRows:q,limitForm:c,limitMessage:E,vcode:w,downloadLinks:B,dialogVisible:J}=P(_),R=te(),{config:g}=P(R),K=(o,e,i)=>e===""?i(new Error("请先输入需要解析的链接")):x(e)?i():i(new Error("请输入合法的链接")),Q=()=>{l.value.dir="/",l.value.surl="";const o=x(l.value.url);o&&(o.id&&(o.surl?(l.value.url=`https://pan.baidu.com/share/init?surl=${o.id}`,l.value.surl=`1${o.id}`):(l.value.url=`https://pan.baidu.com/s/${o.id}`,l.value.surl=o.id)),o.pwd&&(l.value.pwd=o.pwd,C.success("已自动填写密码")))},x=o=>{const e=o.match(/s\/([a-zA-Z0-9_-]+)/),i=o.match(/surl=([a-zA-Z0-9_-]+)/),p=o.match(/\?pwd=([a-zA-Z0-9_-]+)/),u=o.match(/&pwd=([a-zA-Z0-9_-]+)/),m=o.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);let b;if(i)b=i[1];else if(e)b=e[1];else return!1;const L=p?p[1]:u?u[1]:m?m[1]:null;return i?{surl:!0,id:b,pwd:L}:{id:b,pwd:L}},j={url:[{required:!0,validator:K,trigger:"blur"}]},H=async o=>{if(!o||!await o.validate())return;const e=new URLSearchParams;e.set("url",l.value.url),e.set("surl",l.value.surl),e.set("pwd",l.value.pwd),e.set("dir",l.value.dir),oe(`${location.host}/?${e.toString()}`,"复制成功")};re(()=>{ne(()=>{const o=localStorage.getItem("token");o&&o!==""&&(C.success("已自动填充 token"),l.value.token=o);const e=new URLSearchParams(location.search);if(e.size<4)return;const i=e.get("url"),p=e.get("pwd"),u=e.get("dir"),m=e.get("surl");!i||!p||!u||!m||(l.value={url:i,pwd:p,dir:u,surl:m},C.success("已读取到参数,正在加载"),setTimeout(_.getFileList,500))}),_.getLimit(),I()});const A=ie(),O=()=>A.push("/login"),W=()=>A.push("/admin"),X=o=>window.open(o),z=$(0),I=()=>z.value=Date.now(),D=()=>B.value=[],F=$(!1),Y=()=>{l.value.token!==""?(F.value=!0,localStorage.setItem("token",l.value.token??"")):(F.value=!1,localStorage.removeItem("token")),_.getLimit()};return(o,e)=>{const i=de,p=pe,u=me,m=fe,b=ge,L=ce,h=ke;return ue((r(),d(L,null,{default:a(()=>[k("h2",null,"前台解析中心 | "+v(t(le)()),1),t(g).show_copyright?(r(),d(i,{key:0,"show-icon":"",type:"warning",closable:!1,title:t(g).custom_copyright},null,8,["title"])):f("",!0),t(g).have_account?(r(),d(i,{key:1,closable:!1,class:"alert",title:"当前中转账号充足",type:"success"})):(r(),d(i,{key:2,closable:!1,class:"alert",title:"当前中转账号不足",type:"error"})),t(g).debug?(r(),d(i,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):f("",!0),t(g).is_https?f("",!0):(r(),d(i,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),t(E)===""?(r(),d(i,{key:5,class:"alert",type:"success",closable:!1},{default:a(()=>[F.value?(r(),V("span",ye,[k("span",null,"当前卡密: "+v(t(c).group_name),1),k("span",null,"剩余可解析文件数: "+v(t(c).count),1),k("span",null,"剩余可解析大小: "+v(t(Z)(t(c).size)),1),k("span",null," 到期时间: "+v(t(c).expired_at==="未使用"?t(c).expired_at:new Date(t(c).expired_at??0).toLocaleString()),1)])):(r(),V("span",_e,[k("span",null,"当前用户组: "+v(t(c).group_name),1),k("span",null,"剩余可解析文件数: "+v(t(c).count),1),k("span",null,"剩余可解析大小: "+v(t(Z)(t(c).size)),1)]))]),_:1})):(r(),d(i,{key:6,class:"alert",type:"error",closable:!1},{default:a(()=>[y(v(t(E)??"未知错误"),1)]),_:1})),n(b,{ref_key:"getFileListFormRef",ref:U,model:t(l),rules:j,"label-width":"auto",class:"form","label-position":M.value},{default:a(()=>[n(u,{label:"链接",prop:"url"},{default:a(()=>[n(p,{modelValue:t(l).url,"onUpdate:modelValue":e[0]||(e[0]=s=>t(l).url=s),modelModifiers:{trim:!0},onChange:e[1]||(e[1]=s=>D()),onBlur:e[2]||(e[2]=s=>Q())},null,8,["modelValue"])]),_:1}),n(u,{label:"密码",prop:"pwd"},{default:a(()=>[n(p,{modelValue:t(l).pwd,"onUpdate:modelValue":e[3]||(e[3]=s=>t(l).pwd=s),modelModifiers:{trim:!0},onChange:e[4]||(e[4]=s=>D())},null,8,["modelValue"])]),_:1}),t(g).need_password?(r(),d(u,{key:0,label:"解析密码",prop:"password"},{default:a(()=>[n(p,{modelValue:t(l).password,"onUpdate:modelValue":e[5]||(e[5]=s=>t(l).password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):f("",!0),t(g).token_mode?(r(),d(u,{key:1,label:"卡密(不用留空即可)",prop:"token"},{default:a(()=>[n(p,{modelValue:t(l).token,"onUpdate:modelValue":e[6]||(e[6]=s=>t(l).token=s),modelModifiers:{trim:!0},onBlur:Y},null,8,["modelValue"])]),_:1})):f("",!0),n(u,{label:"当前路径",prop:"dir"},{default:a(()=>[n(p,{modelValue:t(l).dir,"onUpdate:modelValue":e[7]||(e[7]=s=>t(l).dir=s),disabled:""},null,8,["modelValue"])]),_:1}),t(w).hit_captcha?(r(),V(S,{key:2},[n(u,{label:"验证码编号",prop:"vcode_str"},{default:a(()=>[n(p,{modelValue:t(w).vcode_str,"onUpdate:modelValue":e[8]||(e[8]=s=>t(w).vcode_str=s),disabled:""},null,8,["modelValue"])]),_:1}),n(u,{label:"验证码图片",prop:"vcode_img"},{default:a(()=>[k("img",{src:`${t(w).vcode_img}&t=${z.value}`,alt:"验证码图片",onClick:I},null,8,we)]),_:1}),n(u,{label:"验证码字符",prop:"vcode_input"},{default:a(()=>[n(p,{modelValue:t(w).vcode_input,"onUpdate:modelValue":e[9]||(e[9]=s=>t(w).vcode_input=s)},null,8,["modelValue"])]),_:1})],64)):f("",!0),t(T)()==="admin"?(r(),d(u,{key:3,label:"解析账号id,多个使用,分割",prop:"account_ids"},{default:a(()=>[n(p,{modelValue:t(l).account_ids,"onUpdate:modelValue":e[10]||(e[10]=s=>t(l).account_ids=s)},null,8,["modelValue"])]),_:1})):f("",!0),n(u,{label:" ",class:"buttons"},{default:a(()=>[n(m,{type:"primary",onClick:e[11]||(e[11]=s=>t(_).getFileList())},{default:a(()=>e[19]||(e[19]=[y("获取/刷新列表")])),_:1}),n(m,{type:"primary",disabled:t(q).length<=0,onClick:e[12]||(e[12]=s=>t(_).getDownloadLinks())},{default:a(()=>e[20]||(e[20]=[y(" 批量解析 ")])),_:1},8,["disabled"]),n(m,{type:"primary",onClick:e[13]||(e[13]=s=>H(t(U)))},{default:a(()=>e[21]||(e[21]=[y("复制当前地址")])),_:1}),t(B).length!==0?(r(),d(m,{key:0,type:"primary",onClick:e[14]||(e[14]=s=>J.value=!0)},{default:a(()=>e[22]||(e[22]=[y(" 重新显示下载链接 ")])),_:1})):f("",!0),t(g).button_link!==""?(r(),d(m,{key:1,type:"primary",onClick:e[15]||(e[15]=s=>X(t(g).button_link))},{default:a(()=>e[23]||(e[23]=[y(" 前往购买卡密 ")])),_:1})):f("",!0),t(g).show_login_button?(r(),V(S,{key:2},[t(N)()==="0"?(r(),d(m,{key:0,type:"primary",onClick:e[16]||(e[16]=s=>O())},{default:a(()=>e[24]||(e[24]=[y("登陆")])),_:1})):f("",!0),t(N)()==="1"?(r(),V(S,{key:1},[t(T)()==="admin"?(r(),d(m,{key:0,type:"primary",onClick:e[17]||(e[17]=s=>W())},{default:a(()=>e[25]||(e[25]=[y(" 进入后台 ")])),_:1})):f("",!0),n(m,{type:"danger",onClick:e[18]||(e[18]=s=>t(R).logout())},{default:a(()=>e[26]||(e[26]=[y(" 注销 ")])),_:1})],64)):f("",!0)],64)):f("",!0)]),_:1})]),_:1},8,["model","label-position"])]),_:1})),[[h,t(G)]])}}}),Te=ve(be,[["__scopeId","data-v-eaf991a9"]]);export{Te as default};
