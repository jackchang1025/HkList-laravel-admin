import{E as x,d as j,g as A,i as H,j as O,m as G,o as J,u as q,v as K}from"./element-plus@2.7.7_vue@3.4.32_typescript@5.5.3_-BPm-_N_9.js";import{i as v}from"./index-5gje5YFo.js";import{f as w}from"./format-CyW-QbYa.js";import{u as Q}from"./changeConfigForm-RWyqGk0Y.js";import{c as W}from"./copy-Cz63vl_6.js";import{d as X,m as Y,o as E,c as Z,i as e,H as l,L as r,I as ee,G as te,a as ae,F as oe}from"./@vue_runtime-core@3.4.32-BofAHbgu.js";import{r as m,u as h}from"./@vue_reactivity@3.4.32-DksAu7zd.js";import{L as d}from"./@vue_shared@3.4.32-CaCWPAm8.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.4.32-DNdjNMzo.js";import"./lodash-es@4.17.21-BB-zMWwC.js";import"./async-validator@4.2.5-DKvM95Vc.js";import"./@vueuse_core@9.13.0_vue@3.4.32_typescript@5.5.3_-DkVRVfGD.js";import"./@vueuse_shared@9.13.0_vue@3.4.32_typescript@5.5.3_-BbpdFR9m.js";import"./dayjs@1.11.11-Ct2Knyoi.js";import"./@element-plus_icons-vue@2.3.1_vue@3.4.32_typescript@5.5.3_-x2o2c_8n.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./pinia@2.1.7_typescript@5.5.3_vue@3.4.32_typescript@5.5.3_-BSzeUtha.js";import"./vue-demi@0.14.8_vue@3.4.32_typescript@5.5.3_-Dq6ymT-8.js";import"./axios@1.7.2-B4uVmeYG.js";import"./vue-router@4.4.0_vue@3.4.32_typescript@5.5.3_-ByijA4Eg.js";const ne=p=>v.get(`/admin/record?page=${p.page}&size=${p.size}&orderBy=${p.orderBy}`),re=()=>v.get("/admin/record/count"),se=p=>v.delete("/admin/record",{data:{record_ids:[p.id]}}),ie=p=>v.delete("/admin/record",{data:{record_ids:p}}),de=X({__name:"RecordManagement",setup(p){const s=m(!1),y=m(15),b=m(1),C=m("id"),_=m(),z=m([]),g=m({today:{count:0,size:0},total:{count:0,size:0}}),u=async()=>{try{s.value=!0;const o=await ne({page:b.value,size:y.value,orderBy:C.value});_.value=o.data}finally{s.value=!1,await B()}},B=async()=>{try{s.value=!0;const o=await re();g.value=o.data}finally{s.value=!1}},D=async o=>{try{s.value=!0,await se(o),x.success("删除记录成功")}finally{s.value=!1,await u()}},$=async()=>{try{s.value=!0;const o=z.value.map(t=>t.id);await ie(o),x.success("删除记录成功")}finally{s.value=!1,await u()}},I=o=>z.value=o;Y(u);function L(o){return o.map(t=>t.toString(16).padStart(2,"0")).join("")}function F(o,t){const i=t.length,f=[];for(let c=0;c<o.length;c++)f.push(o.charCodeAt(c)^t.charCodeAt(c%i));return L(f)}const V=o=>{const t=Q(),i=t.changeConfigForm.proxy_server;if(!i)return x.warning("未配置代理服务器");W(i+"?data="+F(JSON.stringify({url:o.url,ua:o.ua}),t.changeConfigForm.proxy_password))};return(o,t)=>{var k,R,S;const i=j,f=A,c=H,P=O,n=G,T=J,M=q,N=K;return E(),Z(oe,null,[e(i,{type:"primary",onClick:t[0]||(t[0]=a=>u())},{default:l(()=>[r("刷新列表")]),_:1}),e(i,{type:"danger",disabled:z.value.length<=0,onClick:t[1]||(t[1]=a=>$())},{default:l(()=>[r(" 批量删除 ")]),_:1},8,["disabled"]),e(f,{style:{"margin-left":"20px"}},{default:l(()=>[r(" 累计解析: "+d(g.value.total.count)+" ("+d(h(w)(g.value.total.size??0))+") ",1)]),_:1}),e(f,null,{default:l(()=>[r(" 今日解析: "+d(g.value.today.count)+" ("+d(h(w)(g.value.today.size??0))+") ",1)]),_:1}),e(f,{style:{"margin-left":"20px"}},{default:l(()=>[r(" 按照 "),e(P,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=a=>C.value=a),onChange:u,style:{width:"100px"}},{default:l(()=>[e(c,{key:"id",label:"时间",value:"id"}),e(c,{key:"size",label:"文件大小",value:"size"})]),_:1},8,["modelValue"]),r(" 排序 ")]),_:1}),ee((E(),te(T,{data:((k=_.value)==null?void 0:k.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:I},{default:l(()=>[e(n,{type:"selection",width:"40"}),e(n,{prop:"id",label:"ID"}),e(n,{prop:"ip",label:"IP"}),e(n,{prop:"fs_id",label:"文件ID"}),e(n,{prop:"file.filename",label:"文件名"}),e(n,{prop:"fs_id",label:"文件大小"},{default:l(({row:a})=>[ae("span",null,d(h(w)(a.file.size)),1)]),_:1}),e(n,{prop:"url",label:"下载链接"}),e(n,{prop:"ua",label:"UA"}),e(n,{prop:"user_id",label:"用户ID"},{default:l(({row:a})=>[r(d(a.user_id??"非用戶解析"),1)]),_:1}),e(n,{prop:"token_id",label:"卡密ID"},{default:l(({row:a})=>[r(d(a.token_id??"非卡密解析"),1)]),_:1}),e(n,{prop:"account_id",label:"解析账号ID"}),e(n,{prop:"created_at",label:"创建时间"},{default:l(({row:a})=>[r(d(new Date(a.created_at).toLocaleString()),1)]),_:1}),e(n,{prop:"updated_at",label:"更新时间"},{default:l(({row:a})=>[r(d(new Date(a.updated_at).toLocaleString()),1)]),_:1}),e(n,{width:"220",label:"操作",fixed:"right"},{default:l(({row:a})=>[e(i,{size:"small",type:"primary",onClick:U=>V(a)},{default:l(()=>[r(" 获取代理服务器链接 ")]),_:2},1032,["onClick"]),e(i,{size:"small",type:"danger",onClick:U=>D(a)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,s.value]]),e(M,{"current-page":b.value,"onUpdate:currentPage":t[3]||(t[3]=a=>b.value=a),"page-size":y.value,"onUpdate:pageSize":t[4]||(t[4]=a=>y.value=a),"page-sizes":[15,50,100,500,((R=_.value)==null?void 0:R.total)??100],total:((S=_.value)==null?void 0:S.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Le=le(de,[["__scopeId","data-v-f57bd9b1"]]);export{Le as default};
