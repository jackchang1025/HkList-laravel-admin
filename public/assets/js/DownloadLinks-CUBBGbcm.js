/* empty css             *//* empty css                   *//* empty css                        *//* empty css                  *//* empty css                 *//* empty css                  */import{i as x,a as A}from"./index-PNpWQo2V.js";import{u as R}from"./aria2Store-BLxZDMWo.js";import{u as I}from"./fileListStore-CHH6_NpV.js";import{c as E}from"./copy-DePUZc8M.js";import{k as J,au as V,a as K,l as p,J as c,K as a,p as k,Q as s,S as o,u as g,R as _,m as P,F as Q,B as h}from"./vue-vendor-BPxk_gY3.js";import{E as r,d as q,n as G,m as H,p as O,o as W,k as X}from"./element-plus-vendor-C_pH9kLN.js";import"./other-vendor-DRuaNSIU.js";const Y=b=>new Promise(d=>setTimeout(d,b)),de=J({__name:"DownloadLinks",setup(b){const d=I(),{downloadLinks:y,dialogVisible:v}=V(d),C=K([]),F=t=>C.value=t,S=R(),{aria2ConfigForm:i,aria2ConfigDialogVisible:L}=V(S),$=async t=>{try{await x.post(`${i.value.host}:${i.value.port}/jsonrpc`,{jsonrpc:"2.0",id:A(),method:"aria2.getVersion",params:[`token:${i.value.token}`]})}catch{return r.error("检查 Aria2 服务状态失败")}try{await x.post(`${i.value.host}:${i.value.port}/jsonrpc`,{jsonrpc:"2.0",id:A(),method:"aria2.addUri",params:[`token:${i.value.token}`,[t.urls?t.urls[t.index]:t.url],{out:t.filename,header:[`User-Agent: ${t.ua}`]}]})}catch{return r.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}r.success(`已把${t.filename}任务发送给下载器`)},U=async()=>{r.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await Y(3e3),r.success("开始下载"),C.value.forEach(t=>$(t))},B=()=>L.value=!0,D=async(t,e)=>{const n=await d.getDownloadLinks(e,!0);if(!n)return r.error("重新解析失败");y.value[t]=n[0]},z=t=>{y.value[t].index++};return(t,e)=>{const n=q,T=G,u=H,j=O,N=W,M=X;return p(),c(M,{title:"链接列表",modelValue:g(v),"onUpdate:modelValue":e[2]||(e[2]=l=>h(v)?v.value=l:null),"align-center":"","show-close":"","close-on-click-modal":!1},{default:a(()=>[e[9]||(e[9]=k("h3",null,[s("下载请推荐使用Aria2下载器,如 "),k("a",{href:"https://motrix.app/",target:"_blank"},"Motrix")],-1)),e[10]||(e[10]=k("h3",null,"IDM下载需要手动指定UA,点击即可复制",-1)),e[11]||(e[11]=k("h3",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可以单独重新解析单个文件",-1)),o(T,null,{default:a(()=>[o(n,{type:"primary",disabled:C.value.length<=0,onClick:e[0]||(e[0]=l=>U())},{default:a(()=>e[3]||(e[3]=[s(" 批量下载 ")])),_:1},8,["disabled"]),o(n,{type:"primary",onClick:e[1]||(e[1]=l=>B())},{default:a(()=>e[4]||(e[4]=[s("下载配置")])),_:1})]),_:1}),o(N,{border:"","show-overflow-tooltip":"",class:"table",data:g(y),onSelectionChange:F},{default:a(()=>[o(u,{type:"selection",width:"40"}),o(u,{prop:"ua",label:"UA"},{default:a(({row:l})=>[o(j,{type:"danger",onClick:m=>g(E)(l.ua,"已复制UA")},{default:a(()=>[s(_(l.ua??l.url),1)]),_:2},1032,["onClick"])]),_:1}),o(u,{prop:"filename",label:"文件名"}),o(u,{prop:"url",label:"下载链接"},{default:a(({row:l})=>[s(_(l.urls?l.urls[l.index]:l.url),1)]),_:1}),o(u,{label:"操作",width:"400"},{default:a(({row:l,$index:m})=>[o(n,{type:"primary",size:"small",onClick:f=>g(E)(l.urls?l.urls[l.index]:l.url,"已将链接复制到粘贴板内")},{default:a(()=>e[5]||(e[5]=[s(" 复制链接 ")])),_:2},1032,["onClick"]),o(n,{type:"primary",size:"small",onClick:f=>$(l)},{default:a(()=>e[6]||(e[6]=[s(" 发送Aria2 ")])),_:2},1032,["onClick"]),l.urls?(p(),P(Q,{key:0},[l.index<l.urls.length-1?(p(),c(n,{key:0,type:"danger",size:"small",onClick:f=>z(m)},{default:a(()=>[s(" 更换链接 (当前第"+_(l.index+1)+"条链接) ",1)]),_:2},1032,["onClick"])):(p(),c(n,{key:1,type:"danger",size:"small",onClick:f=>D(m,l.fs_id)},{default:a(()=>e[7]||(e[7]=[s(" 重新解析 ")])),_:2},1032,["onClick"]))],64)):(p(),c(n,{key:1,type:"danger",size:"small",onClick:f=>D(m,l.fs_id)},{default:a(()=>e[8]||(e[8]=[s(" 重新解析 ")])),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}});export{de as default};
