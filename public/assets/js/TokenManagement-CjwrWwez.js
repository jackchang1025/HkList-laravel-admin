/* empty css             *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                  *//* empty css                        */import{k as J,av as ee,aw as le,a as V,l as k,J as T,K as a,S as t,Q as v,L as r,m as K,F as Q,a7 as te,d as ae,p as z,R as f,T as g,u as I,P as N}from"./vue-vendor-BPxk_gY3.js";import{i as x}from"./index-PNpWQo2V.js";/* empty css                   *//* empty css                     */import{E as M,i as ne,j as oe,c as ue,r as H,b as W,e as de,d as X,k as se,v as Y,m as ie,w as pe,o as me,u as re}from"./element-plus-vendor-C_pH9kLN.js";import{c as P}from"./copy-DePUZc8M.js";import{f as G}from"./format-CyW-QbYa.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./other-vendor-DRuaNSIU.js";const fe=i=>x.post("/admin/token",i),ye=i=>x.post("/admin/token/generate",i),_e=i=>x.get(`/admin/token?page=${i.page}&size=${i.size}`),ge=i=>x.patch(`/admin/token/${i.id}`,i),ke=i=>x.delete("/admin/token",{data:{token_ids:[i.id]}}),ce=i=>x.delete("/admin/token",{data:{token_ids:i}}),Ve=J({__name:"AddToken",props:{modelValue:{},modelModifiers:{}},emits:ee(["getTokens"],["update:modelValue"]),setup(i,{emit:y}){const $=y,C=le(i,"modelValue"),b=V(!1),n=V({type:"single",name:"",count:1,size:1,day:1}),_=V(null),F={name:[{required:!0,message:"请输入卡密名称",trigger:"blur"}],token_count:[{required:!0,message:"请输入卡密个数",trigger:"blur"}],day:[{required:!0,message:"请输入卡密天数",trigger:"blur"}],count:[{required:!0,message:"请输入可下载次数",trigger:"blur"}],size:[{required:!0,message:"请输入可下载大小",trigger:"blur"}]},B=async U=>{if(!(!U||!await U.validate()))try{b.value=!0,n.value.type==="single"?await fe({type:"single",name:n.value.name,count:n.value.count,size:n.value.size,day:n.value.day}):await ye({type:"random",token_count:n.value.token_count,count:n.value.count,size:n.value.size,day:n.value.day}),M.success("添加成功")}finally{b.value=!1}},L=U=>{$("getTokens"),U()},j=()=>{C.value=!1,$("getTokens")};return(U,o)=>{const E=ne,q=oe,c=ue,u=H,l=W,s=de,p=X,D=se,S=Y;return k(),T(D,{title:"添加卡密",width:"60%",modelValue:C.value,"onUpdate:modelValue":o[8]||(o[8]=d=>C.value=d),"before-close":L},{footer:a(()=>[t(p,{type:"info",onClick:o[6]||(o[6]=d=>j())},{default:a(()=>o[9]||(o[9]=[v("取消")])),_:1}),t(p,{type:"primary",onClick:o[7]||(o[7]=d=>B(_.value))},{default:a(()=>o[10]||(o[10]=[v("添加")])),_:1})]),default:a(()=>[r((k(),T(s,{ref_key:"addTokenFormRef",ref:_,model:n.value,rules:F,"label-width":"auto"},{default:a(()=>[t(c,{label:"创建方式",prop:"type"},{default:a(()=>[t(q,{modelValue:n.value.type,"onUpdate:modelValue":o[0]||(o[0]=d=>n.value.type=d)},{default:a(()=>[(k(),K(Q,null,te(["single","random"],d=>t(E,{key:d,label:d,value:d},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"可用次数",prop:"count"},{default:a(()=>[t(u,{modelValue:n.value.count,"onUpdate:modelValue":o[1]||(o[1]=d=>n.value.count=d)},null,8,["modelValue"])]),_:1}),t(c,{label:"可用天数",prop:"day"},{default:a(()=>[t(u,{modelValue:n.value.day,"onUpdate:modelValue":o[2]||(o[2]=d=>n.value.day=d)},null,8,["modelValue"])]),_:1}),t(c,{label:"可用大小(GB)",prop:"size"},{default:a(()=>[t(u,{modelValue:n.value.size,"onUpdate:modelValue":o[3]||(o[3]=d=>n.value.size=d)},null,8,["modelValue"])]),_:1}),n.value.type==="single"?(k(),T(c,{key:0,label:"卡密名称",prop:"name"},{default:a(()=>[t(l,{modelValue:n.value.name,"onUpdate:modelValue":o[4]||(o[4]=d=>n.value.name=d)},null,8,["modelValue"])]),_:1})):(k(),T(c,{key:1,label:"卡密个数",prop:"token_count"},{default:a(()=>[t(u,{modelValue:n.value.token_count,"onUpdate:modelValue":o[5]||(o[5]=d=>n.value.token_count=d)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[S,b.value]])]),_:1},8,["modelValue"])}}}),be=J({__name:"TokenManagement",setup(i){const y=V(!1),$=V(15),C=V(1),b=V(),n=V([]),_=async()=>{try{y.value=!0;const u=await _e({page:C.value,size:$.value});b.value=u.data}finally{y.value=!1}},F=async u=>{u.edit=!(u.edit??!1)},B=async u=>{u.edit=!(u.edit??!0),await L(u)},L=async u=>{try{y.value=!0,await ge(u),M.success("修改卡密成功")}finally{y.value=!1,await _()}},j=async u=>{try{y.value=!0,await ke(u),M.success("删除卡密成功")}finally{y.value=!1,await _()}},U=async()=>{try{y.value=!0;const u=n.value.map(l=>l.id);await ce(u),M.success("删除卡密成功")}finally{y.value=!1,await _()}},o=u=>n.value=u;ae(_);const E=V(!1),q=()=>E.value=!E.value,c=(u=!0)=>{if(!u){P(n.value.map(s=>s.name).join(`
`));return}const l=n.value.map(s=>[s.name,s.count,s.size,s.day].join(" | "));l.unshift(["卡密","可用次数","可下载量","可用天数"].join(" | ")),P(l.join(`
`))};return(u,l)=>{var R,A,O;const s=X,p=ie,D=W,S=H,d=pe,Z=me,w=re,h=Y;return k(),K(Q,null,[t(Ve,{onGetTokens:_,modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e)},null,8,["modelValue"]),t(s,{type:"primary",onClick:l[1]||(l[1]=e=>_())},{default:a(()=>l[8]||(l[8]=[v("刷新列表")])),_:1}),t(s,{type:"primary",onClick:l[2]||(l[2]=e=>q())},{default:a(()=>l[9]||(l[9]=[v("添加卡密")])),_:1}),t(s,{type:"primary",disabled:n.value.length<=0,onClick:l[3]||(l[3]=e=>c())},{default:a(()=>l[10]||(l[10]=[v(" 批量复制 ")])),_:1},8,["disabled"]),t(s,{type:"primary",disabled:n.value.length<=0,onClick:l[4]||(l[4]=e=>c(!1))},{default:a(()=>l[11]||(l[11]=[v(" 批量复制(无格式) ")])),_:1},8,["disabled"]),t(s,{type:"danger",disabled:n.value.length<=0,onClick:l[5]||(l[5]=e=>U())},{default:a(()=>l[12]||(l[12]=[v(" 批量删除 ")])),_:1},8,["disabled"]),r((k(),T(Z,{data:((R=b.value)==null?void 0:R.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:o},{default:a(()=>[t(p,{type:"selection",width:"40"}),t(p,{prop:"id",label:"ID"}),t(p,{prop:"name",label:"卡密名称"},{default:a(({row:e})=>[r(z("span",null,f(e.name),513),[[g,!e.edit]]),r(t(D,{modelValue:e.name,"onUpdate:modelValue":m=>e.name=m},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),t(p,{prop:"today_size",label:"今日解析"},{default:a(({row:e})=>[z("span",null,f(e.today_count)+" ("+f(I(G)(e.today_size??0))+")",1)]),_:1}),t(p,{prop:"today_size",label:"縂共解析"},{default:a(({row:e})=>[z("span",null,f(e.total_count)+" ("+f(I(G)(e.total_size??0))+")",1)]),_:1}),t(p,{prop:"count",label:"可用次数"},{default:a(({row:e})=>[r(z("span",null,f(e.count),513),[[g,!e.edit]]),r(t(S,{modelValue:e.count,"onUpdate:modelValue":m=>e.count=m},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),t(p,{prop:"size",label:"可下载大小"},{default:a(({row:e})=>[r(z("span",null,f(e.size),513),[[g,!e.edit]]),r(t(S,{modelValue:e.size,"onUpdate:modelValue":m=>e.size=m},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),t(p,{prop:"day",label:"有效期"},{default:a(({row:e})=>[r(z("span",null,f(e.day),513),[[g,!e.edit]]),r(t(S,{modelValue:e.day,"onUpdate:modelValue":m=>e.day=m},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),t(p,{prop:"expired_at",label:"到期时间",width:"250"},{default:a(({row:e})=>[r(z("span",null,f(e.expired_at?`${new Date(e.expired_at).getTime()<Date.now()?"(已过期) ":""}${new Date(e.expired_at).toLocaleString()}`:"未使用"),513),[[g,!e.edit]]),e.edit?(k(),T(d,{key:0,modelValue:e.expired_at,"onUpdate:modelValue":m=>e.expired_at=m,type:"datetime",placeholder:"请选择日期"},null,8,["modelValue","onUpdate:modelValue"])):N("",!0)]),_:1}),t(p,{prop:"ip",label:"ip"},{default:a(({row:e})=>[r(z("span",null,f(e.ip??"未绑定ip"),513),[[g,!e.edit]]),r(t(D,{modelValue:e.ip,"onUpdate:modelValue":m=>e.ip=m},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),t(p,{prop:"created_at",label:"创建时间"},{default:a(({row:e})=>[v(f(new Date(e.created_at).toLocaleString()),1)]),_:1}),t(p,{prop:"updated_at",label:"更新时间"},{default:a(({row:e})=>[v(f(new Date(e.updated_at).toLocaleString()),1)]),_:1}),t(p,{width:"200",label:"操作",fixed:"right"},{default:a(({row:e})=>[e.edit?N("",!0):(k(),T(s,{key:0,size:"small",type:"primary",onClick:m=>F(e)},{default:a(()=>l[13]||(l[13]=[v(" 编辑 ")])),_:2},1032,["onClick"])),e.edit?(k(),T(s,{key:1,size:"small",type:"primary",onClick:m=>B(e)},{default:a(()=>l[14]||(l[14]=[v(" 保存 ")])),_:2},1032,["onClick"])):N("",!0),t(s,{size:"small",type:"primary",onClick:m=>I(P)(e.name)},{default:a(()=>l[15]||(l[15]=[v("复制")])),_:2},1032,["onClick"]),t(s,{size:"small",type:"danger",onClick:m=>j(e)},{default:a(()=>l[16]||(l[16]=[v("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[h,y.value]]),t(w,{"current-page":C.value,"onUpdate:currentPage":l[6]||(l[6]=e=>C.value=e),"page-size":$.value,"onUpdate:pageSize":l[7]||(l[7]=e=>$.value=e),"page-sizes":[15,50,100,500,((A=b.value)==null?void 0:A.total)??100],total:((O=b.value)==null?void 0:O.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Re=ve(be,[["__scopeId","data-v-9f80afaa"]]);export{Re as default};
