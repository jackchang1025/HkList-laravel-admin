import{E as M,b as j,c as ae,i as H,j as J,q as Q,e as le,d as W,k as oe,v as X,m as ne,o as de,u as se}from"./element-plus@2.7.7_vue@3.4.32_typescript@5.5.3_-BPm-_N_9.js";import{v as K}from"./@vue_runtime-dom@3.4.32-DNdjNMzo.js";import{i as h}from"./index-BCRs1Pzi.js";import{d as Y,_ as ie,$ as re,o as w,G as E,H as a,i as t,L as c,I as g,c as I,F as T,R as Z,m as ue,a as N,K as G}from"./@vue_runtime-core@3.4.32-BofAHbgu.js";import{r as _}from"./@vue_reactivity@3.4.32-DksAu7zd.js";import{L as S}from"./@vue_shared@3.4.32-CaCWPAm8.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./lodash-es@4.17.21-BB-zMWwC.js";import"./async-validator@4.2.5-DKvM95Vc.js";import"./@vueuse_core@9.13.0_vue@3.4.32_typescript@5.5.3_-DkVRVfGD.js";import"./@vueuse_shared@9.13.0_vue@3.4.32_typescript@5.5.3_-BbpdFR9m.js";import"./dayjs@1.11.11-Ct2Knyoi.js";import"./@element-plus_icons-vue@2.3.1_vue@3.4.32_typescript@5.5.3_-x2o2c_8n.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./pinia@2.1.7_typescript@5.5.3_vue@3.4.32_typescript@5.5.3_-BSzeUtha.js";import"./vue-demi@0.14.8_vue@3.4.32_typescript@5.5.3_-Dq6ymT-8.js";import"./axios@1.7.2-B4uVmeYG.js";import"./vue-router@4.4.0_vue@3.4.32_typescript@5.5.3_-ByijA4Eg.js";const me=i=>h({url:"/keywords",method:"get",params:i}),ce=i=>h({url:"/keywords",method:"post",data:i}),_e=i=>h({url:`/keywords/${i.id}`,method:"put",data:i}),ye=i=>h({url:`/keywords/${i.id}`,method:"delete"}),ve=i=>h({url:"/keywords/batch",method:"delete",data:{ids:i}}),fe=Y({__name:"AddKeyword",props:{modelValue:{},modelModifiers:{}},emits:ie(["getKeywords"],["update:modelValue"]),setup(i,{emit:u}){const V=u,y=re(i,"modelValue"),v=_(!1),C={contains:"包含",equals:"等于",not_equals:"不等于"},n=_({keyword:"",match_type:"contains",description:"",is_active:!0}),U=_(null),p={keyword:[{required:!0,message:"请输入关键词",trigger:"blur"}],match_type:[{required:!0,message:"请选择匹配规则",trigger:"change"}]},F=async k=>{if(!(!k||!await k.validate()))try{v.value=!0;const d={keyword:n.value.keyword,match_type:n.value.match_type,description:n.value.description,is_active:Number(n.value.is_active)};await ce(d),M.success("添加成功"),y.value=!1,V("getKeywords")}finally{v.value=!1}},q=k=>{V("getKeywords"),k()},D=()=>{y.value=!1,V("getKeywords")};return(k,d)=>{const x=j,b=ae,o=H,l=J,f=Q,m=le,$=W,B=oe,L=X;return w(),E(B,{title:"添加关键词",width:"60%",modelValue:y.value,"onUpdate:modelValue":d[6]||(d[6]=s=>y.value=s),"before-close":q},{footer:a(()=>[t($,{type:"info",onClick:d[4]||(d[4]=s=>D())},{default:a(()=>[c("取消")]),_:1}),t($,{type:"primary",onClick:d[5]||(d[5]=s=>F(U.value))},{default:a(()=>[c("添加")]),_:1})]),default:a(()=>[g((w(),E(m,{ref_key:"addKeywordFormRef",ref:U,model:n.value,rules:p,"label-width":"auto"},{default:a(()=>[t(b,{label:"关键词",prop:"keyword"},{default:a(()=>[t(x,{modelValue:n.value.keyword,"onUpdate:modelValue":d[0]||(d[0]=s=>n.value.keyword=s)},null,8,["modelValue"])]),_:1}),t(b,{label:"匹配规则",prop:"match_type"},{default:a(()=>[t(l,{modelValue:n.value.match_type,"onUpdate:modelValue":d[1]||(d[1]=s=>n.value.match_type=s)},{default:a(()=>[(w(),I(T,null,Z(C,(s,z)=>t(o,{key:z,label:s,value:z},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"描述",prop:"description"},{default:a(()=>[t(x,{modelValue:n.value.description,"onUpdate:modelValue":d[2]||(d[2]=s=>n.value.description=s),type:"textarea"},null,8,["modelValue"])]),_:1}),t(b,{label:"状态",prop:"is_active"},{default:a(()=>[t(f,{modelValue:n.value.is_active,"onUpdate:modelValue":d[3]||(d[3]=s=>n.value.is_active=s),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[L,v.value]])]),_:1},8,["modelValue"])}}}),ge=Y({__name:"KeywordManagement",setup(i){const u=_(!1),V=_(15),y=_(1),v=_(),C=_([]),n=_(!1),U={contains:"包含",equals:"等于",not_equals:"不等于"},p=async()=>{try{u.value=!0;const o=await me({page:y.value,size:V.value});o.data.data=o.data.data.map(l=>({...l,is_active:!!l.is_active})),v.value=o.data}finally{u.value=!1}},F=o=>{o.edit=!0},q=async o=>{o.edit=!1,await D(o)},D=async o=>{try{u.value=!0;const l={...o,is_active:Number(o.is_active)};await _e(l),M.success("修改关键词成功")}finally{u.value=!1,await p()}},k=async o=>{try{u.value=!0,await ye(o),M.success("删除关键词成功")}finally{u.value=!1,await p()}},d=async()=>{try{u.value=!0;const o=C.value.map(l=>l.id);await ve(o),M.success("批量删除关键词成功")}finally{u.value=!1,await p()}},x=o=>C.value=o,b=()=>n.value=!n.value;return ue(p),(o,l)=>{var A,R,O;const f=W,m=ne,$=j,B=H,L=J,s=Q,z=de,ee=se,te=X;return w(),I(T,null,[t(fe,{onGetKeywords:p,modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=e=>n.value=e)},null,8,["modelValue"]),t(f,{type:"primary",onClick:l[1]||(l[1]=e=>p())},{default:a(()=>[c("刷新列表")]),_:1}),t(f,{type:"primary",onClick:l[2]||(l[2]=e=>b())},{default:a(()=>[c("添加关键词")]),_:1}),t(f,{type:"danger",disabled:C.value.length<=0,onClick:l[3]||(l[3]=e=>d())},{default:a(()=>[c(" 批量删除 ")]),_:1},8,["disabled"]),g((w(),E(z,{data:((A=v.value)==null?void 0:A.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:x},{default:a(()=>[t(m,{type:"selection",width:"40"}),t(m,{prop:"id",label:"ID"}),t(m,{prop:"keyword",label:"关键词"},{default:a(({row:e})=>[g(N("span",null,S(e.keyword),513),[[K,!e.edit]]),g(t($,{modelValue:e.keyword,"onUpdate:modelValue":r=>e.keyword=r},null,8,["modelValue","onUpdate:modelValue"]),[[K,e.edit]])]),_:1}),t(m,{prop:"match_type",label:"匹配规则"},{default:a(({row:e})=>[g(N("span",null,S(U[e.match_type]),513),[[K,!e.edit]]),g(t(L,{modelValue:e.match_type,"onUpdate:modelValue":r=>e.match_type=r},{default:a(()=>[(w(),I(T,null,Z(U,(r,P)=>t(B,{key:P,label:r,value:P},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[K,e.edit]])]),_:1}),t(m,{prop:"description",label:"描述"},{default:a(({row:e})=>[g(N("span",null,S(e.description),513),[[K,!e.edit]]),g(t($,{modelValue:e.description,"onUpdate:modelValue":r=>e.description=r},null,8,["modelValue","onUpdate:modelValue"]),[[K,e.edit]])]),_:1}),t(m,{prop:"is_active",label:"状态"},{default:a(({row:e})=>[t(s,{modelValue:e.is_active,"onUpdate:modelValue":r=>e.is_active=r,disabled:!e.edit,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(m,{prop:"created_at",label:"创建时间"},{default:a(({row:e})=>[c(S(new Date(e.created_at).toLocaleString()),1)]),_:1}),t(m,{width:"150",label:"操作",fixed:"right"},{default:a(({row:e})=>[e.edit?G("",!0):(w(),E(f,{key:0,size:"small",type:"primary",onClick:r=>F(e)},{default:a(()=>[c(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(w(),E(f,{key:1,size:"small",type:"primary",onClick:r=>q(e)},{default:a(()=>[c(" 保存 ")]),_:2},1032,["onClick"])):G("",!0),t(f,{size:"small",type:"danger",onClick:r=>k(e)},{default:a(()=>[c("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,u.value]]),t(ee,{"current-page":y.value,"onUpdate:currentPage":l[4]||(l[4]=e=>y.value=e),"page-size":V.value,"onUpdate:pageSize":l[5]||(l[5]=e=>V.value=e),"page-sizes":[15,50,100,500,((R=v.value)==null?void 0:R.total)??100],total:((O=v.value)==null?void 0:O.total)??100,layout:"sizes, prev, pager, next",onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Ie=pe(ge,[["__scopeId","data-v-3354fa5e"]]);export{Ie as default};
